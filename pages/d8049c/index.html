<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>python_ansible自动化运维 | YAO blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?67b18e147ab89b527558aac88ec1f0d1"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="记录">
    <meta name="keywords" content="个人技术博客">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.4d143ccc.css" as="style"><link rel="preload" href="/assets/js/app.59a8e6e3.js" as="script"><link rel="preload" href="/assets/js/7.5b954204.js" as="script"><link rel="preload" href="/assets/js/11.e66a5eb7.js" as="script"><link rel="preload" href="/assets/js/6.90de7719.js" as="script"><link rel="prefetch" href="/assets/js/10.8a2a77f4.js"><link rel="prefetch" href="/assets/js/100.af833779.js"><link rel="prefetch" href="/assets/js/101.3e099687.js"><link rel="prefetch" href="/assets/js/102.c9d471cf.js"><link rel="prefetch" href="/assets/js/103.d6d1a625.js"><link rel="prefetch" href="/assets/js/104.162f33cc.js"><link rel="prefetch" href="/assets/js/105.f1e54397.js"><link rel="prefetch" href="/assets/js/106.7f19132a.js"><link rel="prefetch" href="/assets/js/107.25371832.js"><link rel="prefetch" href="/assets/js/108.14a43b70.js"><link rel="prefetch" href="/assets/js/109.37e03610.js"><link rel="prefetch" href="/assets/js/110.e940d0fa.js"><link rel="prefetch" href="/assets/js/111.5d476651.js"><link rel="prefetch" href="/assets/js/112.d0b7a263.js"><link rel="prefetch" href="/assets/js/113.c0bff7cc.js"><link rel="prefetch" href="/assets/js/114.3dd80315.js"><link rel="prefetch" href="/assets/js/115.22645312.js"><link rel="prefetch" href="/assets/js/116.f56a9f42.js"><link rel="prefetch" href="/assets/js/117.d3fdb340.js"><link rel="prefetch" href="/assets/js/118.a85c5b68.js"><link rel="prefetch" href="/assets/js/119.cde4ed8e.js"><link rel="prefetch" href="/assets/js/12.7976eb91.js"><link rel="prefetch" href="/assets/js/13.e34ffe26.js"><link rel="prefetch" href="/assets/js/14.abe41aab.js"><link rel="prefetch" href="/assets/js/15.2f6b2d7e.js"><link rel="prefetch" href="/assets/js/16.7a6c465a.js"><link rel="prefetch" href="/assets/js/17.e7c80b0c.js"><link rel="prefetch" href="/assets/js/18.cde4ea2c.js"><link rel="prefetch" href="/assets/js/19.185b6820.js"><link rel="prefetch" href="/assets/js/2.b39077a8.js"><link rel="prefetch" href="/assets/js/20.cba57736.js"><link rel="prefetch" href="/assets/js/21.6809dd05.js"><link rel="prefetch" href="/assets/js/22.dcbc5cc3.js"><link rel="prefetch" href="/assets/js/23.6d0df575.js"><link rel="prefetch" href="/assets/js/24.16dea3e3.js"><link rel="prefetch" href="/assets/js/25.a2b79fc1.js"><link rel="prefetch" href="/assets/js/26.c5f5308d.js"><link rel="prefetch" href="/assets/js/27.8bbc4428.js"><link rel="prefetch" href="/assets/js/28.5c54dc8e.js"><link rel="prefetch" href="/assets/js/29.a42e46bb.js"><link rel="prefetch" href="/assets/js/3.cffbebe7.js"><link rel="prefetch" href="/assets/js/30.b43bac5d.js"><link rel="prefetch" href="/assets/js/31.0c62fcfe.js"><link rel="prefetch" href="/assets/js/32.34648702.js"><link rel="prefetch" href="/assets/js/33.08c87895.js"><link rel="prefetch" href="/assets/js/34.4d59a704.js"><link rel="prefetch" href="/assets/js/35.646b44d2.js"><link rel="prefetch" href="/assets/js/36.80a66b27.js"><link rel="prefetch" href="/assets/js/37.421e403a.js"><link rel="prefetch" href="/assets/js/38.9d29f791.js"><link rel="prefetch" href="/assets/js/39.d0200840.js"><link rel="prefetch" href="/assets/js/4.8b2ef19f.js"><link rel="prefetch" href="/assets/js/40.1891e335.js"><link rel="prefetch" href="/assets/js/41.97d3fd6c.js"><link rel="prefetch" href="/assets/js/42.7aa1318f.js"><link rel="prefetch" href="/assets/js/43.aab7a212.js"><link rel="prefetch" href="/assets/js/44.4b5fa36a.js"><link rel="prefetch" href="/assets/js/45.622ff538.js"><link rel="prefetch" href="/assets/js/46.d610e05a.js"><link rel="prefetch" href="/assets/js/47.12e2255c.js"><link rel="prefetch" href="/assets/js/48.b4cefb73.js"><link rel="prefetch" href="/assets/js/49.6c3bf149.js"><link rel="prefetch" href="/assets/js/5.42a2c2db.js"><link rel="prefetch" href="/assets/js/50.1c8ab9e9.js"><link rel="prefetch" href="/assets/js/51.31841acd.js"><link rel="prefetch" href="/assets/js/52.23852199.js"><link rel="prefetch" href="/assets/js/53.502b55d4.js"><link rel="prefetch" href="/assets/js/54.b331ed80.js"><link rel="prefetch" href="/assets/js/55.bf542ba6.js"><link rel="prefetch" href="/assets/js/56.06f8cb6c.js"><link rel="prefetch" href="/assets/js/57.ae52b41c.js"><link rel="prefetch" href="/assets/js/58.a2c555a8.js"><link rel="prefetch" href="/assets/js/59.41061973.js"><link rel="prefetch" href="/assets/js/60.afd2f7e6.js"><link rel="prefetch" href="/assets/js/61.432756d0.js"><link rel="prefetch" href="/assets/js/62.3d00c9f9.js"><link rel="prefetch" href="/assets/js/63.fac02541.js"><link rel="prefetch" href="/assets/js/64.db31a905.js"><link rel="prefetch" href="/assets/js/65.afdcd498.js"><link rel="prefetch" href="/assets/js/66.778ae81f.js"><link rel="prefetch" href="/assets/js/67.582bbbfe.js"><link rel="prefetch" href="/assets/js/68.c44f2518.js"><link rel="prefetch" href="/assets/js/69.8b84437e.js"><link rel="prefetch" href="/assets/js/70.d9666edf.js"><link rel="prefetch" href="/assets/js/71.00fc5abd.js"><link rel="prefetch" href="/assets/js/72.fc04c1ec.js"><link rel="prefetch" href="/assets/js/73.13c1b537.js"><link rel="prefetch" href="/assets/js/74.8dc2ad4d.js"><link rel="prefetch" href="/assets/js/75.200d8e30.js"><link rel="prefetch" href="/assets/js/76.7adde9e3.js"><link rel="prefetch" href="/assets/js/77.9358fcea.js"><link rel="prefetch" href="/assets/js/78.40ebfe7c.js"><link rel="prefetch" href="/assets/js/79.7101d682.js"><link rel="prefetch" href="/assets/js/8.92500b61.js"><link rel="prefetch" href="/assets/js/80.29a4e018.js"><link rel="prefetch" href="/assets/js/81.3b09ac83.js"><link rel="prefetch" href="/assets/js/82.04f9540f.js"><link rel="prefetch" href="/assets/js/83.1abe25fb.js"><link rel="prefetch" href="/assets/js/84.5522a475.js"><link rel="prefetch" href="/assets/js/85.77fd8cc9.js"><link rel="prefetch" href="/assets/js/86.242da1b1.js"><link rel="prefetch" href="/assets/js/87.c1fd2733.js"><link rel="prefetch" href="/assets/js/88.e7217205.js"><link rel="prefetch" href="/assets/js/89.97500137.js"><link rel="prefetch" href="/assets/js/9.c42660e0.js"><link rel="prefetch" href="/assets/js/90.57fd7b16.js"><link rel="prefetch" href="/assets/js/91.f9553e3a.js"><link rel="prefetch" href="/assets/js/92.27cac0ad.js"><link rel="prefetch" href="/assets/js/93.19a43abc.js"><link rel="prefetch" href="/assets/js/94.351f08fe.js"><link rel="prefetch" href="/assets/js/95.36d4d224.js"><link rel="prefetch" href="/assets/js/96.952d6929.js"><link rel="prefetch" href="/assets/js/97.58bb623b.js"><link rel="prefetch" href="/assets/js/98.d3e75111.js"><link rel="prefetch" href="/assets/js/99.a46116ac.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4d143ccc.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="YAO blog" class="logo"> <span class="site-name can-hide">YAO blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/shujuku/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>传统数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ee767f/" class="nav-link">postgresql</a></li><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">mysql</a></li><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">oracle</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/sql/" class="nav-link">《sql编程》</a></li><li class="dropdown-subitem"><a href="/note/dashuju/" class="nav-link">《大数据》</a></li><li class="dropdown-subitem"><a href="/note/postgresql/" class="nav-link">《postgresql》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维专项" class="dropdown-title"><a href="/yunwei/" class="link-title">运维专项</a> <span class="title" style="display:none;">运维专项</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/331efa/" class="nav-link">Docker&amp;k8s</a></li><li class="dropdown-item"><!----> <a href="/pages/0d801d/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/pages/48e74d/" class="nav-link">监控</a></li><li class="dropdown-item"><!----> <a href="/pages/d11aa9/" class="nav-link">linux知识</a></li><li class="dropdown-item"><!----> <a href="/pages/2f40d8/" class="nav-link">ansible</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><a href="/biancheng/" class="link-title">编程</a> <span class="title" style="display:none;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74c26a/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">shell</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">C/C++/GO</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="梦工厂" class="dropdown-title"><a href="/dream/" class="link-title">梦工厂</a> <span class="title" style="display:none;">梦工厂</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/115b2f/" class="nav-link">树莓派</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">Stm32/arduino</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">人工智能</a></li></ul></div></div><div class="nav-item"><a href="/guanyu/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/339240/" class="nav-link">一个人的世界观</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>luoyao</h3> <span>不积跬步 无以至千里</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/shujuku/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>传统数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ee767f/" class="nav-link">postgresql</a></li><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">mysql</a></li><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">oracle</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/sql/" class="nav-link">《sql编程》</a></li><li class="dropdown-subitem"><a href="/note/dashuju/" class="nav-link">《大数据》</a></li><li class="dropdown-subitem"><a href="/note/postgresql/" class="nav-link">《postgresql》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维专项" class="dropdown-title"><a href="/yunwei/" class="link-title">运维专项</a> <span class="title" style="display:none;">运维专项</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/331efa/" class="nav-link">Docker&amp;k8s</a></li><li class="dropdown-item"><!----> <a href="/pages/0d801d/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/pages/48e74d/" class="nav-link">监控</a></li><li class="dropdown-item"><!----> <a href="/pages/d11aa9/" class="nav-link">linux知识</a></li><li class="dropdown-item"><!----> <a href="/pages/2f40d8/" class="nav-link">ansible</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><a href="/biancheng/" class="link-title">编程</a> <span class="title" style="display:none;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74c26a/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">shell</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">C/C++/GO</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="梦工厂" class="dropdown-title"><a href="/dream/" class="link-title">梦工厂</a> <span class="title" style="display:none;">梦工厂</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/115b2f/" class="nav-link">树莓派</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">Stm32/arduino</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">人工智能</a></li></ul></div></div><div class="nav-item"><a href="/guanyu/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/339240/" class="nav-link">一个人的世界观</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>python</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/74c26a/" class="sidebar-link">python入门</a></li><li><a href="/pages/3e70db/" class="sidebar-link">win_linux_rsync</a></li><li><a href="/pages/104e91/" class="sidebar-link">如何在列表，字典，集合中根据条件筛选数据</a></li><li><a href="/pages/68a8d5/" class="sidebar-link">如何快速找到多个字典的公共键</a></li><li><a href="/pages/b1ff18/" class="sidebar-link">如何让字典保持有序</a></li><li><a href="/pages/7d9b60/" class="sidebar-link">如何实现用户的历史记录功能</a></li><li><a href="/pages/51b1e1/" class="sidebar-link">如何使用生成器函数实现迭代对象</a></li><li><a href="/pages/ba0343/" class="sidebar-link">tcpudp编程知识</a></li><li><a href="/pages/90b547/" class="sidebar-link">多线程编程</a></li><li><a href="/pages/2da2d6/" class="sidebar-link">进程和线程</a></li><li><a href="/pages/d8049c/" aria-current="page" class="active sidebar-link">python_ansible自动化运维</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_1-背景" class="sidebar-link">1.背景</a></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_2-让项目跑起来" class="sidebar-link">2.让项目跑起来</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d8049c/#_2-1使工程运行起来" class="sidebar-link">2.1使工程运行起来</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_3-在win上设置环境" class="sidebar-link">3.在win上设置环境</a></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_4-django的工程目录结构" class="sidebar-link">4.django的工程目录结构</a></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_5-python基础" class="sidebar-link">5.python基础</a></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_6-django入门" class="sidebar-link">6.django入门</a></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_7-工程设计" class="sidebar-link">7.工程设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d8049c/#通过命令端方式访问django内容" class="sidebar-link">通过命令端方式访问django内容</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_8-信息接口" class="sidebar-link">8.信息接口</a></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_9-django日志logging模块" class="sidebar-link">9.Django日志logging模块</a></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_10-邮件发送" class="sidebar-link">10.邮件发送</a></li><li class="sidebar-sub-header level2"><a href="/pages/d8049c/#_11-imoocc工程中对于django框架的应用" class="sidebar-link">11.imoocc工程中对于django框架的应用</a></li></ul></li><li><a href="/pages/861bc8/" class="sidebar-link">python_ansible自动化运维2</a></li><li><a href="/pages/0049a6/" class="sidebar-link">python_ansible自动化运维3</a></li><li><a href="/pages/ac6e7d/" class="sidebar-link">python_ansible自动化运维4</a></li><li><a href="/pages/2bbe27/" class="sidebar-link">django入门了解</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>c&amp;c++&amp;go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-5add8e0a><div class="articleInfo" data-v-5add8e0a><ul class="breadcrumbs" data-v-5add8e0a><li data-v-5add8e0a><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-5add8e0a></a></li> <li data-v-5add8e0a><a href="/biancheng/#编程" data-v-5add8e0a>编程</a></li><li data-v-5add8e0a><a href="/biancheng/#python" data-v-5add8e0a>python</a></li></ul> <div class="info" data-v-5add8e0a><div title="作者" class="author iconfont icon-touxiang" data-v-5add8e0a><a href="javascript:;" data-v-5add8e0a>luoyao</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-5add8e0a><a href="javascript:;" data-v-5add8e0a>2022-12-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">python_ansible自动化运维<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="_1-背景"><a href="#_1-背景" class="header-anchor">#</a> 1.背景</h2> <p>之后慢慢补充</p> <p><img src="/assets/img/image-20221221202252325.dbce5c9c.png" alt="image-20221221202252325"></p> <p><img src="/assets/img/image-20221221202306498.50dab49d.png" alt="image-20221221202306498"></p> <p>工程详细简介</p> <p>https://www.imooc.com/article/47506</p> <h2 id="_2-让项目跑起来"><a href="#_2-让项目跑起来" class="header-anchor">#</a> 2.让项目跑起来</h2> <p>基础环境需要安装</p> <p>python2.7+pip</p> <p>之后导入项目文件，在项目文件下执行</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/imoocc_online$ pip install -r requirements.txt 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>效果如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/imoocc_online$ pip install -r requirements.txt 
Collecting Django==1.8.2 (from -r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/4e/9d/2a1835ccbf8e1f0d6755d0e938ffd855f23886d055a7a18cc00a5224a99b/Django-1.8.2-py2.py3-none-any.whl (6.2MB)
    100% |████████████████████████████████| 6.2MB 255kB/s 
Collecting ansible==2.4.1.0 (from -r requirements.txt (line 2))
。。。。。。。
Collecting diff-match-patch==20121119 (from -r requirements.txt (line 12))
  Downloading https://files.pythonhosted.org/packages/22/82/46eaeab04805b4fac17630b59f30c4f2c8860988bc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里安装包出现了问题有报错</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    Traceback (most recent call last):
      File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
      File &quot;setuptools/__init__.py&quot;, line 8, in &lt;module&gt;
        import _distutils_hack.override  # noqa: F401
      File &quot;_distutils_hack/__init__.py&quot;, line 194
        f'spec_for_{name}',
                         ^
    SyntaxError: invalid syntax
    
    ----------------------------------------
Command &quot;python setup.py egg_info&quot; failed with error code 1 in /tmp/pip-build-yVZXKB/setuptools/
You are using pip version 8.1.1, however version 22.3.1 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>解决方法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>wget https://bootstrap.pypa.io/pip/2.7/get-pip.py
python get-pip.py
pip install --upgrade setuptools
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>安装数据库,安装mysql的时候注意输入密码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo apt install mysql-server
sudo apt install redis-server -y
sudo apt install mongodb -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/img/image-20221221204615324.4b4d389e.png" alt="image-20221221204615324"></p> <p>模拟连接mysql,mongodb,redis</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#启动mysql
/etc/init.d/mysql start
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ /etc/init.d/mysql start
[....] Starting mysql (via systemctl): mysql.service==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===
Authentication is required to start 'mysql.service'.
Authenticating as: ly,,, (ly)
Password: 
==== AUTHENTICATION COMPLETE ===
. ok 
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ /etc/init.d/mysql status
● mysql.service - MySQL Community Server
   Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset: enabled)
   Active: active (running) since 三 2022-12-21 21:08:58 CST; 2min 39s ago
 Main PID: 65383 (mysqld)
   CGroup: /system.slice/mysql.service
           └─65383 /usr/sbin/mysqld

12月 21 21:08:57 ly systemd[1]: Starting MySQL Community Server...
12月 21 21:08:58 ly systemd[1]: Started MySQL Community Server.
12月 21 21:11:30 ly systemd[1]: Started MySQL Community Server.

#连接mysql
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ mysql -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.7.33-0ubuntu0.16.04.1 (Ubuntu)

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;  

#启动mongo
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ /etc/init.d/mongodb start

#修改mongo的监听端口
vim /etc/mongodb.cong
bind_ip = 127.0.0.1改为0.0.0.0
目的是为了让别的可以访问到，修改参数之后需要重启mongo
/etc/init.d/mongodb restart

#同理修改redis-server的bind.防止程序无法连接
bind 127.0.0.1
改为
bind  0.0.0.0
重启redis
sudo /etc/init.d/redis-server restart
登录连接测试
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ redis-cli 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p>进入文件，里面有mysql配置数据库的连接信息，需要在数据上新建库，用户和对应的密码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/imoocc_online$ sudo vim admin/settings/settings.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20221221212801743.113223e7.png" alt="image-20221221212801743"></p> <p>先修改MySQL的字符集,添加以下代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim /etc/mysql/my.cnf
[client]
default-character-set=utf8

[mysqld]
character-set-server=utf8
collation-server=utf8_general_ci

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>改完之后重启mysql</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/imoocc_online$ sudo /etc/init.d/mysql restart
#进入数据库
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ sudo mysql -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.7.33-0ubuntu0.16.04.1 (Ubuntu)

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; create database imoocc;
Query OK, 1 row affected (0.00 sec)

mysql&gt; grant all on imoocc.* to imoocc@'127.0.0.1' identified by '123456';
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql&gt; flush privileges;
Query OK, 0 rows affected (0.00 sec)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>django的工程导入表，迁移命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/imoocc_online$ python ./manage.py makemigrations
Migrations for 'detail':
  0002_auto_20221221_2143.py:
    - Alter field datatime on statisticsrecord
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ 
#再次执行migrate就会连接数据库建立表格了
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ python ./manage.py migrate
Operations to perform:
  Synchronize unmigrated apps: staticfiles, django_crontab, messages, crispy_forms
  Apply all migrations: operations, users, sessions, admin, scanhosts, detail, auth, contenttypes
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
  Installing custom SQL...
Running migrations:
  Rendering model states... DONE
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying detail.0001_initial... OK
  Applying detail.0002_auto_20221221_2143... OK
  Applying operations.0001_initial... OK
  Applying scanhosts.0001_initial... OK
  Applying sessions.0001_initial... OK
  Applying users.0001_initial... OK
ly@ly:/mnt/hgfs/ros_share/imoocc_online$ 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>使用生成的账号测试能否成功连接</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/imoocc_online$ mysql -uimoocc -p -h127.0.0.1
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 11
Server version: 5.7.33-0ubuntu0.16.04.1 (Ubuntu)

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; use imoocc
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; show tables;
+----------------------------+
| Tables_in_imoocc           |
+----------------------------+
| auth_group                 |
| auth_group_permissions     |
| auth_permission            |
| auth_user                  |
| auth_user_groups           |
| auth_user_user_permissions |
| cabinetinfo                |
| connectioninfo             |
| django_admin_log           |
| django_content_type        |
| django_migrations          |
| django_session             |
| hostloginifo               |
| machineoperationsinfo      |
| netconnectioninfo          |
| networkinfo                |
| othermachineinfo           |
| physicalserverinfo         |
| statisticsrecord           |
| userinfo                   |
| virtualserverinfo          |
+----------------------------+
21 rows in set (0.01 sec)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>可以看到表格已经建立</p> <h3 id="_2-1使工程运行起来"><a href="#_2-1使工程运行起来" class="header-anchor">#</a> 2.1使工程运行起来</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/imoocc_online$ python ./manage.py runserver 0.0.0.0:8000
Performing system checks...

System check identified no issues (0 silenced).
December 21, 2022 - 21:49:48
Django version 1.8.2, using settings 'admin.settings.settings'
Starting development server at http://0.0.0.0:8000/
Quit the server with CONTROL-C.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在浏览器输入对应ip和端口就能访问对应工程了</p> <h2 id="_3-在win上设置环境"><a href="#_3-在win上设置环境" class="header-anchor">#</a> 3.在win上设置环境</h2> <p>设置python2的环境</p> <p><img src="/assets/img/image-20221221221002549.62bc56be.png" alt="image-20221221221002549"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Collecting Django==1.8.2
  Using cached Django-1.8.2-py2.py3-none-any.whl (6.2 MB)
Collecting ansible==2.4.1.0
  Using cached ansible-2.4.1.0.tar.gz (6.7 MB)
ERROR: Could not install packages due to an EnvironmentError: [Error 206] : 'c:\\users\\47361\\appdata\\local\\temp\\pip-install-ghhf__\\ansible\\test/integration/targets/copy/files/subdir/subdir1/circles/subdir1/circles/subdir1/cir
cles/subdir1/circles/subdir1/circles/subdir1/circles/subdir1/circles/subdir1/circles/subdir2/subdir3/'
安装有报错暂时不解决了。ubantu上面可以操作的
跳过ansible安装，别的都可以安装，但是到最后面还有报错因为没有装的又mysql。ubantu环境上啥都有了，就把win当作编辑器就好了。在ubantu上运行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_4-django的工程目录结构"><a href="#_4-django的工程目录结构" class="header-anchor">#</a> 4.django的工程目录结构</h2> <p>apps前端相关代码</p> <p>detail机器详细信息相关的</p> <p>operations机器操作相关的</p> <p>reports机器报告相关的</p> <p>user用户相关</p> <p>修改models的时候会涉及到在detail的models，涉及数据库表格定义相关</p> <p>conf自动化扫描配置文件，自动化执行的配置文件，主机的配置文件</p> <p>extar_apps，ansible的相关模块放里面</p> <p>logs存放日志</p> <p>scanhosts自动化任务扫描</p> <p>taskdo自动化任务执行</p> <p>templates：django框架里面</p> <h2 id="_5-python基础"><a href="#_5-python基础" class="header-anchor">#</a> 5.python基础</h2> <p><img src="/assets/img/image-20221221225458597.bc992655.png" alt="image-20221221225458597"></p> <p>ipython交互解释器</p> <p>安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:~$ sudo pip install ipython
ly@ly:~$ ipython
Python 2.7.12 (default, Mar  1 2021, 11:38:31) 
Type &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.

IPython 5.5.0 -- An enhanced Interactive Python.
?         -&gt; Introduction and overview of IPython's features.
%quickref -&gt; Quick reference.
help      -&gt; Python's own help system.
object?   -&gt; Details about 'object', use 'object??' for extra details.

In [1]:      
#找到历史出入信息
ctrl+r可以多次按
？ aa 会输出aa的详细信息,？？两个问号更详细
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>python的[]元组类型不可变</p> <p>{}字典类型，键值对的关系</p> <p><img src="/assets/img/image-20221221230759095.4e71c90b.png" alt="image-20221221230759095"></p> <p>匿名函数</p> <p><img src="/assets/img/image-20221221231027468.d0a6afa2.png" alt="image-20221221231027468"></p> <p>正则表达式</p> <p>需要提取的内容加上（）</p> <p><img src="/assets/img/image-20221221231348733.e1d00712.png" alt="image-20221221231348733"></p> <p>装饰器</p> <p>**<img src="/assets/img/image-20221221231449723.556150e8.png" alt="image-20221221231449723">**这里是增加一个日志记录的功能，foo想要日志记录的功能直接加@就行了</p> <p><img src="/assets/img/image-20221221231548451.d6ed243d.png" alt="image-20221221231548451"></p> <p>面向对象编程，类里面需要有哪些方法</p> <p><img src="/assets/img/image-20221221231753672.24daac30.png" alt="image-20221221231753672"></p> <p><img src="/assets/img/image-20221221232001338.248e569c.png" alt="image-20221221232001338"></p> <h2 id="_6-django入门"><a href="#_6-django入门" class="header-anchor">#</a> 6.django入门</h2> <p><img src="/assets/img/image-20221221232056419.6f53333a.png" alt="image-20221221232056419"></p> <p>一个容器项目下面有多个应用项目</p> <p><img src="/assets/img/image-20221221232307642.6e488d21.png" alt="image-20221221232307642"></p> <p>django安装的位置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:~$ pip install Django==1.8.2
DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality.
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: Django==1.8.2 in ./.local/lib/python2.7/site-packages (1.8.2)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:~$ whereis django-admin 
django-admin: /home/ly/.local/bin/django-admin.pyc /home/ly/.local/bin/django-admin /home/ly/.local/bin/django-admin.py
ly@ly:~$ 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>新建django工程</p> <p>新建mydevops工程和scanhosts应用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share$ django-admin startproject mydevops
ly@ly:/mnt/hgfs/ros_share$ ls
imoocc_online  mydevops  setuptools-28.8.0.zip
ly@ly:/mnt/hgfs/ros_share$ cd mydevops/
ly@ly:/mnt/hgfs/ros_share/mydevops$ ls
manage.py  mydevops
ly@ly:/mnt/hgfs/ros_share/mydevops$ python ./manage.py startapp scanhosts
ly@ly:/mnt/hgfs/ros_share/mydevops$ ls
manage.py  mydevops  scanhosts
ly@ly:/mnt/hgfs/ros_share/mydevops$ 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/assets/img/image-20221221233044149.0c3b950f.png" alt="image-20221221233044149"></p> <p>urls.py进行对应路由的</p> <p>setting.py配置</p> <p>建立scanhosts应用</p> <p><img src="/assets/img/image-20221221233242784.6558fdc1.png" alt="image-20221221233242784"></p> <p>views.py逻辑处理文件</p> <p><img src="/assets/img/image-20221222212320796.3c1f326c.png" alt="image-20221222212320796"></p> <p><img src="/assets/img/image-20221222212408035.522bf71f.png" alt="image-20221222212408035"></p> <p>django启动方式</p> <p>这样启动可以在PC机器上访问</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/mydevops$ python manage.py runserver 0.0.0.0:8000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20221222212720923.305a288b.png" alt="image-20221222212720923"></p> <p><img src="/assets/img/image-20221224094835527.89be9b15.png" alt="image-20221224094835527"></p> <p>对于新建的应用，需要被工程使用，在setting.py中配置。这里是scanhosts。启用这个工程</p> <p><img src="/assets/img/image-20221222213202876.a8b3bb87.png" alt="image-20221222213202876"></p> <p><img src="/assets/img/image-20221224095102525.28cc8394.png" alt="image-20221224095102525"></p> <p>在setting.py中还需要配置数据库连接，init_command初始化命令</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'mydevops'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'mysqlpass'</span><span class="token punctuation">,</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'init_command'</span><span class="token punctuation">:</span> <span class="token string">'SET storage_engine=INNODB,'</span>
                        <span class="token string">'SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED, autocommit=1, names &quot;utf8&quot;;'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="/assets/img/image-20221222224028370.93ede729.png" alt="image-20221222224028370"></p> <p>设计好model类型</p> <p>ip,name字段名字</p> <p>db_table表格的名字</p> <p>orm对象关系映射，对modle模型进行操作，不用直接对数据库进行操作</p> <p><img src="/assets/img/image-20221222224147500.027aa66d.png" alt="image-20221222224147500"></p> <p>根据这个方式定义好模型</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># -*- coding:utf-8 -*-
from django.db import models

# Create your models here.
class UserIPinfo(models.Model):
    ip = models.CharField(max_length=40, default='', verbose_name=u'ip地址', null=True)
    time = models.DateTimeField(verbose_name=u&quot;更新时间&quot;, auto_now=True)

    class Meta:
        verbose_name = u'用户访问地址信息表'
        verbose_name_plural = verbose_name
        db_table = &quot;userinfo&quot;

class BrowseInfo(models.Model):
    useragent = models.CharField(max_length=100, default='', verbose_name=u'用户浏览器agent信息', null=True)
    models.CharField(max_length=256, verbose_name=u&quot;唯一设备ID&quot;, default=&quot;&quot;)

    userip = models.ForeignKey('UserIPInfo')

    class Meta:
        verbose_name = u'用户浏览器信息'
        verbose_name_plural = verbose_name
        db_table = &quot;browseinfo&quot;
        
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="/assets/img/image-20221222224717201.443a9817.png" alt="image-20221222224717201"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#class Meta内容的信息详解
verbose_name:指定数据库名称展示为这个值，不指定的话会默认为模型类的名称这里就【应用名字_UserInfo】
verbose_name_pural: 取中文名字，可读性，便于识别
db_table:在数据库中的表名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>模型建立好之后，在数据库中建立对应的库,用户和做好相关授权</p> <p>create database mydevops;</p> <p>grant all on mydevops.* to admin@'127.0.0.1' identified by 'mysqlpass';</p> <p>flush privileges;</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql&gt; create database mydevops;
Query OK, 1 row affected (0.00 sec)

mysql&gt; grant all on mydevops.* to admin@'127.0.0.1' identified by 'mysqlpass';
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql&gt; flush privileges;
Query OK, 0 rows affected (0.00 sec)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在终端模拟测试登录admin</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/mydevops$ mysql -uadmin -h127.0.0.1 -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 21
Server version: 5.7.33-0ubuntu0.16.04.1 (Ubuntu)

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><img src="/assets/img/image-20221222225159903.adf6c117.png" alt="image-20221222225159903"></p> <p><img src="/assets/img/image-20221222225213322.79d8634e.png" alt="image-20221222225213322"></p> <p>python2在有中文的时候需要在最开始配置utf-8,不然会有编码错误</p> <p><img src="/assets/img/image-20221222225323903.5a9a2074.png" alt="image-20221222225323903"></p> <p>建立模型</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/mydevops$ python manage.py makemigrations
Migrations for 'scanhosts':
  0001_initial.py:
    - Create model BrowseInfo
    - Create model UserIPInfo
    - Add field userip to browseinfo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/assets/img/image-20221222225416713.69af7fea.png" alt="image-20221222225416713"></p> <p>把迁移文件转化为sql文件到数据库</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ly@ly:/mnt/hgfs/ros_share/mydevops$ python manage.py migrate
Operations to perform:
  Synchronize unmigrated apps: staticfiles, messages
  Apply all migrations: admin, scanhosts, contenttypes, auth, sessions
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
  Installing custom SQL...
Running migrations:
  Rendering model states... DONE
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying scanhosts.0001_initial... OK
  Applying sessions.0001_initial... OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><img src="/assets/img/image-20221222225508562.c020d566.png" alt="image-20221222225508562"></p> <p>具体查看表</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql&gt; use mydevops;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; show tables;
+----------------------------+
| Tables_in_mydevops         |
+----------------------------+
| auth_group                 |
| auth_group_permissions     |
| auth_permission            |
| auth_user                  |
| auth_user_groups           |
| auth_user_user_permissions |
| browseinfo                 |
| django_admin_log           |
| django_content_type        |
| django_migrations          |
| django_session             |
| userinfo                   |
+----------------------------+
12 rows in set (0.00 sec)

mysql&gt; desc userinfo;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| ip    | varchar(40) | YES  |     | NULL    |                |
| time  | datetime(6) | NO   |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql&gt; desc browseinfo;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int(11)      | NO   | PRI | NULL    | auto_increment |
| useragent | varchar(100) | YES  |     | NULL    |                |
| userip_id | int(11)      | NO   | MUL | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql&gt; 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p><img src="/assets/img/image-20221222225607633.5602844b.png" alt="image-20221222225607633"></p> <h2 id="_7-工程设计"><a href="#_7-工程设计" class="header-anchor">#</a> 7.工程设计</h2> <p><img src="/assets/img/image-20221222225740315.6ee5aecf.png" alt="image-20221222225740315"></p> <p>use_info方法</p> <p><img src="/assets/img/image-20221222225818356.dce69ec2.png" alt="image-20221222225818356"></p> <p>views相关代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>from django.shortcuts import render
from django.http import JsonResponse, HttpResponse
from models import *
import json

# Create your views here.

def user_info(request):
  ip_addr = request.META['REMOTE_ADDR']
  user_ua = request.META['HTTP_USER_AGENT']

  user_obj = UserIPinfo.objects.filter(ip = ip_addr)
  if not user_obj:
    res = UserIPinfo.objects.create(ip = ip_addr)
    # print res.__dict__
    ip_add_id = res.id
  else:
    ip_add_id = user_obj[0].id

  BrowseInfo.objects.create(useragent = user_ua, userip_id = ip_add_id )

  result = {&quot;STATUS&quot;: &quot;success&quot;,
            &quot;INFO&quot;: &quot;User info&quot;,
            &quot;IP&quot;: ip_addr,
            &quot;UA&quot;: user_ua}
  return HttpResponse(json.dumps(result), content_type=&quot;application/json&quot;)

def user_history(request):
    ip_list = UserIPinfo.objects.all()
    infos = {}
    for item in ip_list:
        infos[item.ip] = [ b_obj.useragent for b_obj in BrowseInfo.objects.filter(userip_id= item.id)]

    result = {&quot;STATUS&quot;:&quot;success&quot;,
              &quot;INFO&quot;:infos,
              }
    return HttpResponse(json.dumps(result), content_type=&quot;application/json&quot;)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>models相关代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># -*- coding:utf-8 -*-
from django.db import models

# Create your models here.
class UserIPinfo(models.Model):
    ip = models.CharField(max_length=40, default='', verbose_name=u'ip地址', null=True)
    time = models.DateTimeField(verbose_name=u&quot;更新时间&quot;, auto_now=True)

    class Meta:
        verbose_name = u'用户访问地址信息表'
        verbose_name_plural = verbose_name
        db_table = &quot;userinfo&quot;

class BrowseInfo(models.Model):
    useragent = models.CharField(max_length=500, default='', verbose_name=u'用户浏览器agent信息', null=True)
    models.CharField(max_length=256, verbose_name=u&quot;唯一设备ID&quot;, default=&quot;&quot;)

    userip = models.ForeignKey('UserIPInfo')

    class Meta:
        verbose_name = u'用户浏览器信息'
        verbose_name_plural = verbose_name
        db_table = &quot;browseinfo&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>建立路由转发规则mydevops，urls.py下的相关代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>from django.conf.urls import include, url
from django.contrib import admin
from scanhosts.views import *

urlpatterns = [
    url(r'^admin/', include(admin.site.urls)),
    url(r'^getinfos/$', user_history),
    url(r'^sendinfos/$', user_info),

] 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/assets/img/image-20221222230048931.fb04f579.png" alt="image-20221222230048931"></p> <p>sendinfo会使用user_info方法处理，这部分讲解内容在3-13</p> <p><img src="/assets/img/image-20221222230438469.1bd5e90e.png" alt="image-20221222230438469"></p> <p><img src="/assets/img/image-20221222230600943.1092cb0b.png" alt="image-20221222230600943"></p> <p>filter是django对数据库的查询，create是插入</p> <p><img src="/assets/img/image-20221222230822484.9a41371f.png" alt="image-20221222230822484"></p> <p><img src="/assets/img/image-20221222231102206.65e8e3f1.png" alt="image-20221222231102206"></p> <p>在浏览器中访问方式</p> <p><img src="/assets/img/image-20221222231125507.865b1b6e.png" alt="image-20221222231125507"></p> <p>检查数据库中数据是否插入</p> <p><img src="/assets/img/image-20221222231158563.e925e170.png" alt="image-20221222231158563"></p> <h3 id="通过命令端方式访问django内容"><a href="#通过命令端方式访问django内容" class="header-anchor">#</a> 通过命令端方式访问django内容</h3> <p><img src="/assets/img/image-20221222231342388.f0d48656.png" alt="image-20221222231342388"></p> <h2 id="_8-信息接口"><a href="#_8-信息接口" class="header-anchor">#</a> 8.信息接口</h2> <p><img src="/assets/img/image-20221222231448314.d72f7fdf.png" alt="image-20221222231448314"></p> <p>1.配置好url转发</p> <p><img src="/assets/img/image-20221222231533099.188f5f9f.png" alt="image-20221222231533099"></p> <p>views.py中user_history部分内容</p> <p><img src="/assets/img/image-20221222231614658.842bba1b.png" alt="image-20221222231614658"></p> <p>运行工程，在浏览器查看请求结果</p> <p><img src="/assets/img/image-20221222231755676.d02b3d3e.png" alt="image-20221222231755676"></p> <p><img src="/assets/img/image-20221224125015624.7952e49a.png" alt="image-20221224125015624"></p> <p><img src="/assets/img/image-20221224125034130.e821aa0e.png" alt="image-20221224125034130"></p> <h2 id="_9-django日志logging模块"><a href="#_9-django日志logging模块" class="header-anchor">#</a> 9.Django日志logging模块</h2> <p>logger日志记录器。是日志接口</p> <p>handler日志处理器，邮件发送还是终端上直接打印</p> <p>formatter，格式器格式化除输出日志信息</p> <p>filter过滤器，进行严格筛选</p> <p><img src="/assets/img/image-20221224220739300.31d17703.png" alt="image-20221224220739300"></p> <p>在项目得settings里面配置logging相关信息</p> <p>定义formatters,handlers,loggers相关配置项</p> <p>leverlname:级别</p> <p>asctime：时间日期</p> <p>module：模块信息</p> <p>lineno：对应的行号</p> <p>message:打印信息</p> <p>datefmt:s时间格式</p> <p><img src="/assets/img/image-20221225113135015.9b557fea.png" alt="image-20221225113135015"></p> <p><img src="/assets/img/image-20221225115216661.8be066a9.png" alt="image-20221225115216661"></p> <p>应用的views引入</p> <p><img src="/assets/img/image-20221225120319008.3b0f955e.png" alt="image-20221225120319008"></p> <h2 id="_10-邮件发送"><a href="#_10-邮件发送" class="header-anchor">#</a> 10.邮件发送</h2> <p><img src="/assets/img/image-20221225120727514.49d831dd.png" alt="image-20221225120727514"></p> <p><img src="/assets/img/image-20221225120801196.c8f3c49e.png" alt="image-20221225120801196"></p> <p><img src="/assets/img/image-20221225120826509.473bec9e.png" alt="image-20221225120826509"></p> <p>配置邮件客户端</p> <p><img src="/assets/img/image-20221225120904921.b3f2d99a.png" alt="image-20221225120904921"></p> <p>去服务端开启smtp服务，去邮箱打开</p> <p><img src="/assets/img/image-20221225120934302.192a2b3f.png" alt="image-20221225120934302"></p> <p><img src="/assets/img/image-20221225121026180.fdd81d3f.png" alt="image-20221225121026180"></p> <p>进入项目shell模式，邮件发送测试</p> <p><img src="/assets/img/image-20221225121216504.4a02ab24.png" alt="image-20221225121216504"></p> <p>单独建立一个类处理邮件</p> <p><img src="/assets/img/image-20221225121408603.7ccf63bf.png" alt="image-20221225121408603"></p> <p><img src="/assets/img/image-20221225121425986.17511840.png" alt="image-20221225121425986"></p> <p><img src="/assets/img/image-20221225121443641.252cacac.png" alt="image-20221225121443641"></p> <p>sehll测试</p> <p><img src="/assets/img/image-20221225121710032.752d1b5d.png" alt="image-20221225121710032"></p> <h2 id="_11-imoocc工程中对于django框架的应用"><a href="#_11-imoocc工程中对于django框架的应用" class="header-anchor">#</a> 11.imoocc工程中对于django框架的应用</h2> <p>model对数据库的操作</p> <p>查看django的官方中文文档</p> <p><img src="/assets/img/image-20221225121829913.5d012aef.png" alt="image-20221225121829913"></p> <p>工程架构设计</p> <p><img src="/assets/img/image-20221225122254831.defadd78.png" alt="image-20221225122254831"></p> <p>设置setting文件的目的是：线上线下环境有不同的配置。所以需要设置不通的setting</p> <p>在使用的时候。由于项目的manage.py控制</p> <p>以下是在项目启动的时候读取别的seting文件</p> <p><img src="/assets/img/image-20221225122646879.7e851fb0.png" alt="image-20221225122646879"></p> <p>在manage.py里面需要这样配置</p> <p>sys.argv参数位置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if __name__ == &quot;__main__&quot;:
    if len(sys.argv) &gt; 3:
        run_arg = sys.argv[2]
        if not run_arg.startswith('--settings'):
            os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;admin.settings.settings&quot;)
    else:
        os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;admin.settings.settings&quot;)

    from django.core.management import execute_from_command_line

    execute_from_command_line(sys.argv)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>加入app应用</p> <p><img src="/assets/img/image-20221225123613836.b1e703c0.png" alt="image-20221225123613836"></p> <p>models讲解</p> <p>可以看apps和scanhosts下面的models文件配置信息</p> <p><img src="/assets/img/image-20221225123820416.7eedbe6a.png" alt="image-20221225123820416"></p> <p>里面的外键的解释</p> <p><img src="/assets/img/image-20221225124404192.a9c1f8e2.png" alt="image-20221225124404192"></p> <p>学生属于班级，一个班级多个学生，一个学生只有一个班级</p> <p>通过外键进行关联，通过外键关联</p> <p><img src="/assets/img/image-20221225124500556.069a7d82.png" alt="image-20221225124500556"></p> <p><img src="/assets/img/image-20221225124516177.1e2cb14d.png" alt="image-20221225124516177"></p></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/2da2d6/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">进程和线程</div></a> <a href="/pages/861bc8/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">python_ansible自动化运维2</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/2da2d6/" class="prev">进程和线程</a></span> <span class="next"><a href="/pages/861bc8/">python_ansible自动化运维2</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/505cd2/"><div>
            ansible部署k8s问题点复盘
            <!----></div></a> <span class="date">04-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/5d43b3/"><div>
            博客部署
            <!----></div></a> <span class="date">04-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/fb6db2/"><div>
            ansible远程重启系统之后继续执行命令
            <!----></div></a> <span class="date">03-15</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:473618849@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>备案号 | <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">川公网安备 51012202001343号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.59a8e6e3.js" defer></script><script src="/assets/js/7.5b954204.js" defer></script><script src="/assets/js/11.e66a5eb7.js" defer></script><script src="/assets/js/6.90de7719.js" defer></script>
  </body>
</html>
