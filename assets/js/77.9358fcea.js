(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{980:function(e,r,s){"use strict";s.r(r);var t=s(6),n=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("pg10分区表插入更新无法解决方法")]),e._v(" "),r("p",[e._v("方法1：建立函数\ncreate or replace function f_upsert(integer,character,timestamp) returns void as $$"),r("br"),e._v("\ndeclare"),r("br"),e._v("\nres int;"),r("br"),e._v("\nbegin"),r("br"),e._v("\nupdate users set user_name=$2,logdate=$3 where user_id=$1;"),r("br"),e._v("\nif not found then"),r("br"),e._v("\ninsert into users (user_id,user_name,logdate) values ($1,$2,$3);"),r("br"),e._v("\nend if;"),r("br"),e._v("\nexception when others then"),r("br"),e._v("\nreturn;"),r("br"),e._v("\nend;"),r("br"),e._v("\n$$ language plpgsql strict;")]),e._v(" "),r("p",[e._v("方法2：采用with的方式\nwith upsert as (update users set user_name=$user_name,logdate=$logdate where user_id=$user_id returning *) insert into users select $user_id,$user_name,$logdate where not exists (select 1 from upsert where user_id=$user_id);"),r("br"),e._v("\ninsert into test (id,info,crt_time) values ($1,$2,$3);")]),e._v(" "),r("p",[e._v("with upsert as (update users set user_name='DD',logdate='2021-03-21' where user_id=3 returning *) insert into users select 3,$user_name,$logdate where not exists (select 1 from upsert where user_id=$user_id);")]),e._v(" "),r("p",[e._v("postgres=# select * from users;\nuser_id | user_name |        logdate"),r("br"),e._v("\n---------+-----------+------------------------\n1 | AA        | 2021-01-17 00:00:00-05\n2 | BB        | 2021-02-18 00:00:00-05\n3 | CC        | 2021-03-19 00:00:00-04\n(3 rows)")]),e._v(" "),r("h2",{attrs:{id:"postgres-select-f-upsert-1-2-2021-01-18-f-upsert"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#postgres-select-f-upsert-1-2-2021-01-18-f-upsert"}},[e._v("#")]),e._v(" postgres=# select f_upsert(1,'2','2021-01-18');\nf_upsert")]),e._v(" "),r("p",[e._v("(1 row)")]),e._v(" "),r("p",[e._v("postgres=# select * from users;\nuser_id | user_name |        logdate"),r("br"),e._v("\n---------+-----------+------------------------\n1 | 2         | 2021-01-18 00:00:00-05\n2 | BB        | 2021-02-18 00:00:00-05\n3 | CC        | 2021-03-19 00:00:00-04\n(3 rows)")]),e._v(" "),r("p",[e._v("QHIAHMZZNRSJXTFB")])])}),[],!1,null,null,null);r.default=n.exports}}]);