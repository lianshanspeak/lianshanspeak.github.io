(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{322:function(s,a,t){s.exports=t.p+"assets/img/qgJO9Lak7Sy9AN3oNqldbQ-16632524815971.aa024ef4.png"},323:function(s,a,t){s.exports=t.p+"assets/img/o-TxT0piZa5u7BJUKGGgmw.a3e4f14f.png"},324:function(s,a,t){s.exports=t.p+"assets/img/image-20220915220508065.346dc627.png"},325:function(s,a,t){s.exports=t.p+"assets/img/image-20220915220852556.ca3198dc.png"},326:function(s,a,t){s.exports=t.p+"assets/img/image-20220915221607134.3f099d68.png"},327:function(s,a,t){s.exports=t.p+"assets/img/image-20220915222018853.c780b796.png"},328:function(s,a,t){s.exports=t.p+"assets/img/image-20220915222230250.03116014.png"},329:function(s,a,t){s.exports=t.p+"assets/img/image-20220915222701202.6b8f1456.png"},330:function(s,a,t){s.exports=t.p+"assets/img/image-20220915222954385.51c14a00.png"},963:function(s,a,t){"use strict";t.r(a);var n=t(6),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"日常运维问题处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日常运维问题处理"}},[s._v("#")]),s._v(" 日常运维问题处理")]),s._v(" "),a("h2",{attrs:{id:"_1、对时间分区表-执行vacuum-full报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、对时间分区表-执行vacuum-full报错"}},[s._v("#")]),s._v(" 1、对时间分区表，执行vacuum full报错")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" postgres"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vacuum FULL   xxxxxpart_17;")]),s._v("\n   ERROR:    node:dn001"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" backend_pid:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6576")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   nodename:dn005"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("backend_pid:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26069")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("message:tuple cannot be frozen now"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" please   try later xid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1236320620")]),s._v(" cutoff xid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1239845757")]),s._v(" committs "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34278179476140")]),s._v("   RecentDataTs "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34275437824762")]),s._v(" RecentGlobalXmin "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1239855757")]),s._v(" RecentGlobalDataXmin   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1239855757")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("库的年龄大于200000000，则说明库出现问题\n检查是否大于200000000")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("   查询所有表的年龄\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v("   pg_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nspname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" schema_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("relname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v("   xid_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_table_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" table_size "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("   pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pg_namespace "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" pg_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relnamespace "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v("   age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" relfrozenxid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   查询指定表的年龄\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Select")]),s._v("   pg_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nspname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" schema_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("relname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v("   xid_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_table_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" table_size "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("   pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pg_namespace "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" pg_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relnamespace "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v("   age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" relfrozenxid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" relname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxxxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   在库里面执行，复制出大于"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("亿的表，并且写好执行"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n   \\copy   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vacuum freeze '")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("nspname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("relname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("   pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pg_namespace "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" pg_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relnamespace "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v("   age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" relfrozenxid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/tbase/shell/freeze.sql'")]),s._v("\n   回收表年龄的时候，设置当前会话有效\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v("   vacuum_defer_freeze_min_age "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v("   lock_timeout "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("（可以不指定，超时会报错）\n   执行导出的脚本\n   \\i   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tbase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shell"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("freeze"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n   执行完之后再次统计信息\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pg_namespace "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("   pg_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relnamespace "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v("   relfrozenxid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relfrozenxid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"_2、出现表膨胀问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、出现表膨胀问题"}},[s._v("#")]),s._v(" 2、出现表膨胀问题")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("  postgres"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \\dt+   xxxxx_part_17")]),s._v("\n                                        List "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v("   relations\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Schema")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        Name         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Type")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      Owner    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  Size    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Allocated Size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Description\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------+---------------------+-------+-------------+--------+----------------+-------------")]),s._v("\n    lgzaxt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" xxxxx_part_17 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   xxxxx_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("515")]),s._v(" GB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" GB         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   执行vacuum "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("full")]),s._v("进行回收空间\n   postgres"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vacuum   FULL xxxxx_part_17;")]),s._v("\n   VACUUM\n   postgres"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \\dt+   xxxxx_part_17")]),s._v("\n                                        List "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v("   relations\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Schema")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        Name         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Type")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      Owner    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Size  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Allocated Size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Description\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------+---------------------+-------+-------------+-------+----------------+-------------")]),s._v("\n    lgzaxt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" xxxxx_part_17 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   xxxxx_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" GB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" GB          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   \n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"_3、用户创建schema-并且授予所有权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、用户创建schema-并且授予所有权限"}},[s._v("#")]),s._v(" 3、用户创建schema，并且授予所有权限")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v(" xxxxxzt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SCHEMA")]),s._v(" xxxxxzt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v("   xxxxx_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v(" xxxxxzt owner "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" xxxxx_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("usage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v(" schema_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" user_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n创建用户B授权A用户的视图查询权限\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" user_stu  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" PASSWORD "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12345'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" xl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("view_students "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" user_stu "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("usage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v(" xl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" user_stu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n授权createdb createrole权限\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" xxx createdb；\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"_4、慢查询慢sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、慢查询慢sql"}},[s._v("#")]),s._v(" 4、慢查询慢sql")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("   查询大于"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("分钟慢查询\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_stat_activity "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("   state"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'idel'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" query_start "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10min'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v("   query_start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_5、查询宽表时报out-of-memory-situation-during-sort"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、查询宽表时报out-of-memory-situation-during-sort"}},[s._v("#")]),s._v(" 5、查询宽表时报OUT-of-memory situation during sort")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("原因是：返回的字段数和行数比较多\n解决：临时处理可以把返回的字段数减少或者行数加limit限制\n单独解决：临时修改work_mem参数，再该SQL执行前加上set work_mem=102400;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_6、创建表时报错create-table-is-not-permitted-now-dn切换引入的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、创建表时报错create-table-is-not-permitted-now-dn切换引入的问题"}},[s._v("#")]),s._v(" 6、创建表时报错create table is not permitted now（dn切换引入的问题）")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("原因：其中有dn节点上有锁\n解决：注意去DN节点执行解锁\n每个DN节点查看："),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" show_node_lock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n如果有返回值就进行解锁：node "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unlock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'n'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("；\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_7、突然服务器负载很高-大量的su进程-导致stolon的confdb一直重启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、突然服务器负载很高-大量的su进程-导致stolon的confdb一直重启"}},[s._v("#")]),s._v(" 7、突然服务器负载很高，大量的su进程，导致stolon的confdb一直重启")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("原因：通过"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("top")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c 发现异常进程，由于OSS问题，它一直在监控OSS，然后不停的重启stolon。\n解决：重启OSS即可\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_8、tbase集群数据库闪断并产生大量得core文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、tbase集群数据库闪断并产生大量得core文件"}},[s._v("#")]),s._v(" 8、tbase集群数据库闪断并产生大量得core文件")]),s._v(" "),a("p",[s._v("数据库会闪断，每次闪断有大量得core文件，业务是应用往一个表里写数据，表上有触发器，触发器再去调用存储过程。core文件如下：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("gdb bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("postgres【使用的pg文件路径】 core文件\nbt\n通过f "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\np conn_count\np i\np "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("connections"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n最终定位问题\n解决办法：因为tbase对存储过程里得exception支撑不太友好，把exception删除即可，等后续版本优化\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"_9、bug-视图插入数据到表报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、bug-视图插入数据到表报错"}},[s._v("#")]),s._v(" 9、BUG：视图插入数据到表报错")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("版本2.15.19.1，以上其它版本都是2.15.16.10.报错例子和信息如下：\n解决：是BUG问题，回退版本，后续研发优化\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_10、创建唯一索引报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10、创建唯一索引报错"}},[s._v("#")]),s._v(" 10、创建唯一索引报错")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("postgres"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# create unique index in_ly on ly (name);")]),s._v("\nERROR:  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Unique")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" partitioned "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" must contain the "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("hash")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("modulo distribution "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n解决：创建唯一索引的时候得加上分布键，否则无法创建，或者创建的时候指定该字段为分布建\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("img",{staticStyle:{zoom:"67%"},attrs:{src:t(322),alt:"img"}}),s._v(" "),a("h2",{attrs:{id:"_11-数据导出导入pg-dump和psql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-数据导出导入pg-dump和psql"}},[s._v("#")]),s._v(" 11.数据导出导入pg_dump和psql")]),s._v(" "),a("p",[s._v("导出模式，导出数据库报权限错误，应该接模式名")]),s._v(" "),a("p",[a("img",{attrs:{src:t(323),alt:"img"}})]),s._v(" "),a("p",[s._v("数据导入：多次导入会追加在后面")]),s._v(" "),a("p",[a("img",{attrs:{src:t(324),alt:"image-20220915220508065"}})]),s._v(" "),a("h2",{attrs:{id:"_12、tdsql默认建表数量1000张-否则会报如下错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12、tdsql默认建表数量1000张-否则会报如下错"}},[s._v("#")]),s._v(" 12、TDSQL默认建表数量1000张，否则会报如下错")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("too match tables,exceed the maximum value\n解决：Proxy默认限制是每个实例上只能创建1000张表，可以在proxy的配置文件中修改，修改后重启使其生效。\n路径：/data/tdsql_run/15002/gateway/conf/instance_15002.cnf\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("table "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("”1000”"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n/data/tdsql_run/15003/gateway/bin/stop.sh  instance_15003\n之后proxy会被ocagent自动拉起 或者 start_cgroup.sh  instance_15003\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"_13-、tbase-插入数据-update会报错-select正常-报错如下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-、tbase-插入数据-update会报错-select正常-报错如下"}},[s._v("#")]),s._v(" 13 、tbase  插入数据 update会报错，select正常，报错如下")]),s._v(" "),a("p",[a("img",{attrs:{src:t(325),alt:"image-20220915220852556"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("原因分析：因为该表上有触发器，再调用存储过程，删除触发器可以进行，具体原因还需要产研进行分析\n初步排查，它触发器里去更分布键了。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_14-、授权所有表给另外一个用户-包括后面新建的表-这句前面的表需要手动授权-之后的表会自动授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-、授权所有表给另外一个用户-包括后面新建的表-这句前面的表需要手动授权-之后的表会自动授权"}},[s._v("#")]),s._v(" 14 、授权所有表给另外一个用户，包括后面新建的表（这句前面的表需要手动授权，之后的表会自动授权）")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" schema_owner "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v(" schema_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" user_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_16、不能添加备库问题处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16、不能添加备库问题处理"}},[s._v("#")]),s._v(" 16、不能添加备库问题处理")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("问题现象：\n添加备机失败，center日志中显示主键冲突，因tbl_oss_node_status中存在比序列值更大的nsid，导致新增节点时主键冲突\n检查方法：\nconfdb中执行下面"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tbl_oss_node_status "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" nsid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("currval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tbl_oss_node_status_nsid_seq'")]),s._v("::regclass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" nsid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n是否有记录\n解决办法：\n执行下面的"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("增加序列值，直到大于上面查询到的最大nsid\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" nextval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tbl_oss_node_status_nsid_seq'")]),s._v("::regclass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n解决方法也可以这样\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" setval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tbl_oss_node_status_nsid_seq'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" nsid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tbl_oss_node_status "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" nsid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n扩展：查询批量序列值大的表\n生成"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'select * from '")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nspname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' where '")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' >'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adsrc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nextval'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'currval'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_class c "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_namespace n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relnamespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_attrdef d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adrelid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_attribute t "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrelid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attnum"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adnum "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adsrc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%seq%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'select '")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adsrc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nextval'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'currval'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_class c "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_namespace n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relnamespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_attrdef d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adrelid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_attribute t "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrelid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attnum"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adnum "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adsrc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%seq%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h2",{attrs:{id:"_17、不能分配指定服务器处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_17、不能分配指定服务器处理"}},[s._v("#")]),s._v(" 17、不能分配指定服务器处理")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("临时处理一下\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" tbl_oss_server "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" server_flag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dn'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" server_ip "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" tbl_oss_server "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" server_flag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" server_ip "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" tbl_oss_server "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" server_flag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gtm'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" server_ip "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_18、oss升级后不能添加备机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_18、oss升级后不能添加备机"}},[s._v("#")]),s._v(" 18、OSS升级后不能添加备机")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("一可能是里面有dn节点版本不一致\n二可能缺表字段等\n添加备机不成功的，我按照它的语句检查过confdb的字段，这些字段都是有的。alarm_meta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("里有缺少的表的建表语句\n\n 缺少字段报错对应的"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tbl_oss_project "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" num_of_cn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" cn_groups"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tbl_oss_project "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" cns_in_group "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("integer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tbl_oss_project "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" cold_dn_num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" cold_dn_groups"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tbl_oss_project "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" cold_dns_in_group "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("integer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tbl_oss_server "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" server_flag "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'all'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tbl_oss_db_switch_info "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" slave_flow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tbl_oss_db_switch_info "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" master_flow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tbl_oss_tbase_charset "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" is_visible "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" tbl_oss_tbase_charset "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" is_visible "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" lang_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UTF8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'LATIN1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SQL_ASCII'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EUC_CN'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n三可能主键冲突\n问题现象：\n添加备机失败，center日志中显示主键冲突，因tbl_oss_node_status中存在比序列值更大的nsid，导致新增节点时主键冲突\n\n检查方法：\nconfdb中执行下面"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tbl_oss_node_status "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" nsid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("currval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tbl_oss_node_status_nsid_seq'")]),s._v("::regclass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" nsid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n是否有记录\n解决办法：\n执行下面的"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("增加序列值，直到大于上面查询到的最大nsid\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" nextval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tbl_oss_node_status_nsid_seq'")]),s._v("::regclass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h2",{attrs:{id:"_19、缺少插件function-connect-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_19、缺少插件function-connect-by"}},[s._v("#")]),s._v(" 19、缺少插件function connect by")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("解决方法:\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" search_path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 用户使用的"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" extension tablefunc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_20、时间类型转换问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_20、时间类型转换问题"}},[s._v("#")]),s._v(" 20、时间类型转换问题")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("Cloud "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" choose a best candidate operator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("you might need "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" explicit "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" casts\n解决方法：加 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interval")]),s._v("转换就好了\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(326),alt:"image-20220915221607134"}})]),s._v(" "),a("h2",{attrs:{id:"_22、schema权限问题-error-permission-denied-for-schema"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_22、schema权限问题-error-permission-denied-for-schema"}},[s._v("#")]),s._v(" 22、schema权限问题：ERROR：permission denied for schema *")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("解决方法：\n进入数据库：\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("usage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v(" schema_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" user_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_24-分区表分区不够添加分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_24-分区表分区不够添加分区"}},[s._v("#")]),s._v(" 24.分区表分区不够添加分区,")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("加"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("个分区\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" 主表名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" partitions "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_25、切换dn后所有查询uuid相关的sql报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25、切换dn后所有查询uuid相关的sql报错"}},[s._v("#")]),s._v(" 25、切换DN后所有查询uuid相关的SQL报错")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("解决方法：因为上架的新服务器没有安装UUID相关的包，安装上就可以了，不用重启\nyum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install uuid\nyum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install uuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("devel\nyum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install e2fsprogs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("devel uuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("devel libuuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("devel uuid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_26、查看schema、table大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_26、查看schema、table大小"}},[s._v("#")]),s._v(" 26、查看schema、table大小")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--查看schema")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" schema_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("table_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"disk space"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("table_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" pg_database_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current_database"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent(%)"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nspname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" schema_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n         pg_total_relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" table_size\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("   pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_class\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_namespace \n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" relnamespace "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" t\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" schema_name\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent(%)"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--查看table大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n    table_catalog "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" database_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    table_schema "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" schema_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" table_size\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n        table_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        table_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        pg_total_relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" table_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\".\"'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" table_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" relation_size\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" table_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pg_catalog'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'public'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'public_rb'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'topology'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tiger'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tiger_data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'information_schema'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" relation_size "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" all_tables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--查看表大小及索引占用大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pg_relation_filepath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_table_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" pg_table_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" pg_relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_total_relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" pg_total_relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("indexname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pg_relation_filepath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("indexname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("indexname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" table_index_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       pg_size_pretty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pg_indexes_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" table_all_index_size\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_tables pt\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("outer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_indexes pi\n                   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("pi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n注意：pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schemaname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n对应模式名和表名\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("h2",{attrs:{id:"_27、更新版本后-cn查询视图按tab时卡住-当台服务器上有waiting-pg-blocking-pid指向0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_27、更新版本后-cn查询视图按tab时卡住-当台服务器上有waiting-pg-blocking-pid指向0"}},[s._v("#")]),s._v(" 27、更新版本后，cn查询视图按tab时卡住，当台服务器上有waiting，pg_blocking_pid指向0")]),s._v(" "),a("p",[a("img",{attrs:{src:t(327),alt:"image-20220915222018853"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("解决办法，因为是两阶段事务问题\ncreate extension pg_clean;创建\nselect * from pg_clean_check_txn ();查看两阶段事务\nselect * from pg_clean_execute();清理两阶段\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"image/image-20220915222120561.png",alt:"image-20220915222120561"}}),s._v(" "),a("h2",{attrs:{id:"_28、元数据不一致-有的dn能查询有的dn不能查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_28、元数据不一致-有的dn能查询有的dn不能查询"}},[s._v("#")]),s._v(" 28、元数据不一致，有的dn能查询有的dn不能查询")]),s._v(" "),a("p",[a("img",{attrs:{src:t(328),alt:"image-20220915222230250"}})]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("解决办法：根据报错的relid 到全部dn上查询下面语句找到对应的表\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" relname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_stat_user_tables "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" relid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'370303'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n然后到所有dn查询该表看能不能查出，若有的dn不能查出就是有问题，联系看能否删除\n因为表有问题，不能直接删除，删除会报错，按如下删除：\ndn 上面执行\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" allow_force_ddl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" allow_dml_on_datanode "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v("；\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exists")]),s._v(" xxx；\n最后恢复\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"_29、不能删除索引或者表的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_29、不能删除索引或者表的方法"}},[s._v("#")]),s._v(" 29、不能删除索引或者表的方法")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("提示索引或者表存在，但是去查询或者删除时又查不到，这时删除方法为\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_class "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'oid号'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_depend "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" objid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'oid号'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_30、查看索引坏块的语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_30、查看索引坏块的语句"}},[s._v("#")]),s._v(" 30、查看索引坏块的语句")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("检查已损坏索引：\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" schemaname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("tablename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("indexname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("split_part"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("split_part"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("indexdef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'('")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("')'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_indexes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" indexname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" relname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_class "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" oid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" indexrelid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_index "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" indisvalid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'f'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" tablename "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("asc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_31、查询表时报错如下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_31、查询表时报错如下"}},[s._v("#")]),s._v(" 31、查询表时报错如下")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("ERROR: could "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" access "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transaction")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5483489")]),s._v("\nDETAIL: could "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pg_clog/0202"')]),s._v(" at "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("offset")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":Conseguido\npg_clog 目录下都是事务文件，如果丢失则表信息则不可用\n解决办法：查看目录里其它文件的大小。比如是"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("k ，然后执行下面语句生成一个报错的文件。\ndd "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zero "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0202")]),s._v(" bs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("k count"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_32-database-template0-is-not-currently-accepting-connections"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_32-database-template0-is-not-currently-accepting-connections"}},[s._v("#")]),s._v(" 32.database “template0“ is not currently accepting connections")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("问题：执行尝试登录template0，登录不上，回收template0年轮\n原因：template0 数据库默认是不允许登录的\n解决方法：\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("用超级用户执行以下命令\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" pg_database "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" datallowconn "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("TRUE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" datname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'template0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("进入template0，执行vacuum free"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("有时候自己就回收了，还有执行这个操作。\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("还原权限\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" pg_database "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" datallowconn "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("FALSE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" datname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'template0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"_33-pg10分区表不支持upsert解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_33-pg10分区表不支持upsert解决方法"}},[s._v("#")]),s._v(" 33.pg10分区表不支持upsert解决方法")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("原生pg就不支持，可以采用函数的方式实现\n参考连接：\nhttps:"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//blog.csdn.net/weixin_33896069/article/details/92922520")]),s._v("\nhttps:"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//blog.csdn.net/weixin_34077371/article/details/90588640")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_34-pg9版本年龄查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_34-pg9版本年龄查询"}},[s._v("#")]),s._v(" 34.pg9版本年龄查询")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("在v2版本查询的方式下！=0那里加上age（），\nage(relfrozenxid)!=0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_35、查看tbase得分布键和分区键"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_35、查看tbase得分布键和分区键"}},[s._v("#")]),s._v(" 35、查看tbase得分布键和分区键")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("先根据表名查询出oid也就是下面的pcrelid\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nspname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relname\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_class c\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_namespace n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relnamespace\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^(表名)$'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_table_is_visible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n查看分布键\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CASE")]),s._v(" pclocatortype "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'N'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ROUND ROBIN'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'R'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'REPLICATION'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'H'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HASH'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'S'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SHARD'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'M'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MODULO'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" distype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("  attname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("  a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attnum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcattnum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" discolumn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("  attname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pgxc_class x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_attribute a1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("  a1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3661861")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attnum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("psecondattnum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3661861")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" disseccolumn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CASE")]),s._v(" array_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nodeoids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" nc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dn_cn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ALL DATANODES'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ELSE")]),s._v(" array_to_string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ARRAY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" node_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pgxc_node "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" oid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" unnest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nodeoids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pgxc_class "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" pcrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3661861'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("', '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" loc_nodes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CASE")]),s._v(" array_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("coldnodeoids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" nc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dn_cn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ALL DATANODES'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ELSE")]),s._v(" array_to_string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ARRAY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" node_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pgxc_node "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" oid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" unnest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("coldnodeoids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pgxc_class "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" pcrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3661861'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("', '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" cold_nodes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pg_attribute a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("right")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pgxc_class c "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attnum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcattnum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" dn_cn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pgxc_node "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" node_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'D'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" nc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" pcrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3661861'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n查看分区键\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RANGE('")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("')'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partnparts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partdatatype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partstartvalue_ts :: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partstartvalue_int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CASE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partinterval_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partinterval_int "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' MONTH'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partinterval_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partinterval_int "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' DAY'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ELSE")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partinterval_int "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" step\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_class c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pg_attribute a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pg_partition_interval p\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partpartkey"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attnum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3661861'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"_36、提示stop-the-postmaster-and-vacuum-that-database-in-single-user-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_36、提示stop-the-postmaster-and-vacuum-that-database-in-single-user-mode"}},[s._v("#")]),s._v(" 36、提示stop the postmaster and vacuum that database in single-user mode")]),s._v(" "),a("p",[a("img",{attrs:{src:t(329),alt:"image-20220915222701202"}})]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("解决办法\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、\t停止对应的cn\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、进入单用户模式下回收\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置环境变量，具体路径换成实例环境信息的目录路径")]),s._v("\nexport PGXZ_HOME"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tbase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("user_1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tdata_03"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tbasev2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.15")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("install"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tbase_pgxz"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\nexport PATH"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$PGXZ_HOME"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin:$PATH\nexport LD_LIBRARY_PATH"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$PGXZ_HOME"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib:${LD_LIBRARY_PATH}\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入你要回收的库")]),s._v("\npostgres "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--single -D /data/tbase/user_1/tdata_02/tbase_v2_01_1/data/cn001 postgres")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行回收")]),s._v("\nbackend"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" vacuum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退出")]),s._v("\nbackend"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("修复后按 ctrl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("d 退出\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、修复完启动\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"_38、有一个主dn拉起来有进程但是连不上-并且产生很多得postgresql-conf-rename-tm705400818-pid27878-ppid27258-tid139866427488类似文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_38、有一个主dn拉起来有进程但是连不上-并且产生很多得postgresql-conf-rename-tm705400818-pid27878-ppid27258-tid139866427488类似文件"}},[s._v("#")]),s._v(" 38、有一个主dn拉起来有进程但是连不上，并且产生很多得postgresql.conf.rename.tm705400818.pid27878.ppid27258.tid139866427488类似文件")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("解决办法：从其他dn复制postgresql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf的内容到报错的这个dn，注意修改port端口和pooler_port端口，以及postgresql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("的绝对路劲，两个端口可以在confdb里查询tbl_oss_node表\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_40、重做备机后数据文件同步完了-但是显示重做失败-日志里-v报错信息。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_40、重做备机后数据文件同步完了-但是显示重做失败-日志里-v报错信息。"}},[s._v("#")]),s._v(" 40、重做备机后数据文件同步完了，但是显示重做失败，日志里-V报错信息。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("解决办法：这是由于tbase_oss的bin文件问题，不知道bin文件怎么了，导致重做备机后配置文件跟主dn一致的。从其它正常的dn目录下面拷贝tbase_oss整个文件夹来替换了，然后重做备机即可\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_41、重做备机后数据文件同步完了-但是启动不了-手动启动也是报错。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_41、重做备机后数据文件同步完了-但是启动不了-手动启动也是报错。"}},[s._v("#")]),s._v(" 41、重做备机后数据文件同步完了，但是启动不了，手动启动也是报错。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(330),alt:"image-20220915222954385"}})]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("这是端口占用问题，查看confdb里的端口，和这里的端口对比发现，主dn的 poller_port端口错了，但是重做备机后备机的端口是对的，所以就会冲突，解决就是按照confdb里的tbl_oss_node表里的端口，对应修改postgresql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf里的端口，然后重启即可\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_42、单机创建database和user后-drop-table时报permission-denied-for-schema-pglogical"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_42、单机创建database和user后-drop-table时报permission-denied-for-schema-pglogical"}},[s._v("#")]),s._v(" 42、单机创建database和user后，drop table时报permission denied for schema pglogical")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("创建语法：\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" hahha "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" password "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hahha'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" hahhadb owner hahha"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" hahhadb "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" hahha"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n解决办法：\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("usage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v(" pglogical "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" hahha\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"_43、tdsql-非分布式maridb8-0实例需要关闭主键限制sql-require-primary-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_43、tdsql-非分布式maridb8-0实例需要关闭主键限制sql-require-primary-key"}},[s._v("#")]),s._v(" 43、TDSQL 非分布式maridb8.0实例需要关闭主键限制sql_require_primary_key")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("TDSQL默认要使用主键，还是8.0的实例也默认有参数控制要使用主键，如果实在要取消有也可以，但有主备延迟，性能等一定的风险\n解决办法：\n新的版本直接在赤兔参数管理即可\n如果旧的版本那里没有相关参数的话，到主库，对应的端口mysqlagent下执行下面语句，记得修改端口和set name\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data0/tdsql_run/4036/mysqlagent/bin\n./mysql_param_modify --agent-conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"../conf/mysqlagent_4036.xml"')]),s._v(" --mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"modify"')]),s._v(" --param"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param=sql_require_primary_key&conf=sql_require_primary_key&value=OFF"')]),s._v(" --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"set_1652943133_114"')]),s._v("\n如果是8.0之前的版本只需要在赤兔界面，对应的实例，参数管理找到reject_table_no_pk改为0即可\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);