(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{965:function(a,t,e){"use strict";e.r(t);var i=e(6),g=Object(i.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"深度解析buffer-manager、index-only"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#深度解析buffer-manager、index-only"}},[a._v("#")]),a._v(" 深度解析buffer manager、index-only")]),a._v(" "),t("p",[a._v("什么是脏页？")]),a._v(" "),t("p",[a._v("缓冲管理器结构？1.。2.。3.。干嘛用的")]),a._v(" "),t("p",[a._v("作用：管理共享内存和持久存储之间的数据传输")]),a._v(" "),t("p",[a._v("1.缓冲表")]),a._v(" "),t("p",[a._v("2.缓冲区描述符")]),a._v(" "),t("p",[a._v("3.缓冲池")]),a._v(" "),t("p",[a._v("处理过程：")]),a._v(" "),t("p",[a._v("缓冲管理器收到请求--》缓冲区标签--》找到对应数据页面")]),a._v(" "),t("p",[a._v("缓冲区标签：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328112859993.png",alt:"/image//image-20220328112859993"}})]),a._v(" "),t("p",[a._v("读操作：")]),a._v(" "),t("p",[a._v("写操作：")]),a._v(" "),t("p",[a._v("什么是脏页？")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328202304517.png",alt:"/image//image-20220328202304517"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328202755772.png",alt:"/image//image-20220328202755772"}})]),a._v(" "),t("p",[a._v("缓冲区管理器由那几个层组成")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328202932528.png",alt:"/image//image-20220328202932528"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328204015707.png",alt:"/image//image-20220328204015707"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328204051183.png",alt:"/image//image-20220328204051183"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328204455837.png",alt:"/image//image-20220328204455837"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328204504145.png",alt:"/image//image-20220328204504145"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328204521001.png",alt:"/image//image-20220328204521001"}})]),a._v(" "),t("h2",{attrs:{id:"什么是自旋锁-自旋锁的优点不足"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是自旋锁-自旋锁的优点不足"}},[a._v("#")]),a._v(" 什么是自旋锁，自旋锁的优点不足？")]),a._v(" "),t("h2",{attrs:{id:"buffer-describe-layer-会用到那些锁-作用是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#buffer-describe-layer-会用到那些锁-作用是什么"}},[a._v("#")]),a._v(" buffer describe layer 会用到那些锁，作用是什么？")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328205205607.png",alt:"/image//image-20220328205205607"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328210508882.png",alt:"/image//image-20220328210508882"}})]),a._v(" "),t("p",[a._v("锁：解决并发的问题")]),a._v(" "),t("p",[a._v("缓冲管理器中的五种锁：")]),a._v(" "),t("h2",{attrs:{id:"什么时候会获取独占模式的content-lock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么时候会获取独占模式的content-lock"}},[a._v("#")]),a._v(" 什么时候会获取独占模式的content_lock")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328205901912.png",alt:"/image//image-20220328205901912"}})]),a._v(" "),t("p",[a._v("buffermappingLock128个分区（默认）")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328132403203.png",alt:"/image//image-20220328132403203"}})]),a._v(" "),t("h2",{attrs:{id:"io进行锁-发生时间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#io进行锁-发生时间"}},[a._v("#")]),a._v(" IO进行锁，发生时间")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328210333934.png",alt:"/image//image-20220328210333934"}})]),a._v(" "),t("h2",{attrs:{id:"描述将页面从存储加载到空槽的流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#描述将页面从存储加载到空槽的流程"}},[a._v("#")]),a._v(" 描述将页面从存储加载到空槽的流程？")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328211042611.png",alt:"/image//image-20220328211042611"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328212958015.png",alt:"/image//image-20220328212958015"}})]),a._v(" "),t("h2",{attrs:{id:"什么时候pg会使用环形缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么时候pg会使用环形缓冲区"}},[a._v("#")]),a._v(" 什么时候pg会使用环形缓冲区")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328213902552.png",alt:"/image//image-20220328213902552"}})]),a._v(" "),t("h2",{attrs:{id:"什么是仅索引扫描"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是仅索引扫描"}},[a._v("#")]),a._v(" 什么是仅索引扫描")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328232438274.png",alt:"/image//image-20220328232438274"}})]),a._v(" "),t("h2",{attrs:{id:"hot的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hot的作用"}},[a._v("#")]),a._v(" HOT的作用")]),a._v(" "),t("p",[a._v("数据库行数据更新时，索引也需要进行维护，如果是高并发的情况下，索引维护的代价\n很大，可能造成索引分裂。Pg为了避免这个问题，采用了HOT（"),t("strong",[a._v("堆内元组技术")]),a._v("）解决这\n个问题")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328232627190.png",alt:"/image//image-20220328232627190"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328232635225.png",alt:"/image//image-20220328232635225"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220328232645887.png",alt:"/image//image-20220328232645887"}})]),a._v(" "),t("p",[a._v("查询：共享锁\n插入：独占锁")]),a._v(" "),t("h2",{attrs:{id:"copy协议与事务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#copy协议与事务"}},[a._v("#")]),a._v(" copy协议与事务")]),a._v(" "),t("p",[t("strong",[a._v("Copy 子协议对应三种模式：")])]),a._v(" "),t("p",[a._v("copy-in：导入数据，对应命令 COPY FROM STDIN")]),a._v(" "),t("p",[a._v("copy-out：导出数据，对应命令 COPY TO STDOUT")]),a._v(" "),t("p",[a._v("copy-both：用于 walsender，在主备间批量传输数据")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220329111721950.png",alt:"/image//image-20220329111721950"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220329112025307.png",alt:"/image//image-20220329112025307"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220329112055975.png",alt:"/image//image-20220329112055975"}})]),a._v(" "),t("h1",{attrs:{id:"vacuum-原理解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vacuum-原理解析"}},[a._v("#")]),a._v(" vacuum 原理解析")]),a._v(" "),t("p",[a._v("不同数据库之间历史版本怎么放的？")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220329141037347.png",alt:"/image//image-20220329141037347"}})]),a._v(" "),t("h2",{attrs:{id:"vacuum作用-清理分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vacuum作用-清理分类"}},[a._v("#")]),a._v(" vacuum作用，清理分类？")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220329142139021.png",alt:"/image//image-20220329142139021"}})]),a._v(" "),t("p",[a._v("1.清理死元组")]),a._v(" "),t("p",[a._v("2.freeze 冻结（我比谁都小，我对所用人可见的）")]),a._v(" "),t("p",[a._v("3.analyze更新统计信息")]),a._v(" "),t("h2",{attrs:{id:"理解什么是fsm-什么时候生成的-有什么作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#理解什么是fsm-什么时候生成的-有什么作用"}},[a._v("#")]),a._v(" 理解什么是FSM，什么时候生成的，有什么作用")]),a._v(" "),t("p",[a._v("FSM（Free Space Map），即空闲空间管理。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330110433077.png",alt:"/image//image-20220330110433077"}})]),a._v(" "),t("p",[a._v("https://blog.csdn.net/weixin_39540651/article/details/100933665")]),a._v(" "),t("h2",{attrs:{id:"什么-时候会触发autovacuum"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么-时候会触发autovacuum"}},[a._v("#")]),a._v(" 什么 时候会触发autovacuum")]),a._v(" "),t("p",[a._v("每当死亡元组（dead tuple）超过以下公式时，就会触发自动清理")]),a._v(" "),t("p",[a._v("autovacuum_vacuum_threshold（"),t("strong",[a._v("门槛")]),a._v("） + pg_class.reltuples ("),t("strong",[a._v("表上记录数")]),a._v(")*autovacuum_vacuum_scale_factor（"),t("strong",[a._v("比例因子")]),a._v("）")]),a._v(" "),t("p",[t("strong",[a._v("死亡元组数")]),a._v("可以认为是pg_stat_all_tables中n_dead_tup的值")]),a._v(" "),t("p",[a._v("门槛默认为50，比例因子默认为0.2，就是20%，设置阈值门槛为了避免频繁清理小表，针对大表可以调小比例因子，或者放弃比例因子调大阈值")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330150051165.png",alt:"/image//image-20220330150051165"}})]),a._v(" "),t("p",[t("strong",[a._v("理想方案：")])]),a._v(" "),t("p",[a._v("据各个表的delete和update频繁程度以及表的数据量单独为每个表设置阈值：")]),a._v(" "),t("p",[a._v("ALTER TABLE test SET (autovacuum_vacuum_threshold = 100);")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330150802564.png",alt:"/image//image-20220330150802564"}})]),a._v(" "),t("h2",{attrs:{id:"计算autovacuum计算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#计算autovacuum计算"}},[a._v("#")]),a._v(" 计算autovacuum计算")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330174908192.png",alt:"/image//image-20220330174908192"}})]),a._v(" "),t("h2",{attrs:{id:"autovacuum清理过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#autovacuum清理过程"}},[a._v("#")]),a._v(" autovacuum清理过程")]),a._v(" "),t("p",[a._v('清理过程相当简单,它从数据文件中读取页面(默认8kB数据块),并检查它是否需要清理.如果没有死元组,页面就会被丢弃而不做任何更改.否则它被清理\n(死元组被删除),被标记为"脏"并最终写出来。')]),a._v(" "),t("h1",{attrs:{id:"postgresql并发控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#postgresql并发控制"}},[a._v("#")]),a._v(" postgresql并发控制")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330203913767.png",alt:"/image//image-20220330203913767"}})]),a._v(" "),t("p",[a._v("事务标识 txid，")]),a._v(" "),t("p",[a._v("查看当前txid")]),a._v(" "),t("p",[a._v("select txid_current();")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330204411958.png",alt:"/image//image-20220330204411958"}})]),a._v(" "),t("h2",{attrs:{id:"元组结构由哪几部分组成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#元组结构由哪几部分组成"}},[a._v("#")]),a._v(" 元组结构由哪几部分组成")]),a._v(" "),t("p",[a._v("headtupleHeaderdata:堆元组头数据")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330204444264.png",alt:"/image//image-20220330204444264"}})]),a._v(" "),t("h2",{attrs:{id:"commit-log的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commit-log的作用"}},[a._v("#")]),a._v(" Commit Log的作用")]),a._v(" "),t("p",[a._v("PostgreSQL 在Commit Log 中保存事务的状态。Commit Log，通常称为clog，分配给共享内存，并在整个事务处理过程中使用。")]),a._v(" "),t("h2",{attrs:{id:"postgresql-定义了四种事务状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#postgresql-定义了四种事务状态"}},[a._v("#")]),a._v(" PostgreSQL 定义了四种事务状态")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330205007116.png",alt:"/image//image-20220330205007116"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330205612781.png",alt:"/image//image-20220330205612781"}})]),a._v(" "),t("h2",{attrs:{id:"理解事务是否活跃"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#理解事务是否活跃"}},[a._v("#")]),a._v(" 理解事务是否活跃")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330205727542.png",alt:"/image//image-20220330205727542"}})]),a._v(" "),t("h2",{attrs:{id:"freeze原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#freeze原理"}},[a._v("#")]),a._v(" freeze原理")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330210059905.png",alt:"/image//image-20220330210059905"}})]),a._v(" "),t("h2",{attrs:{id:"表空间空闲率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#表空间空闲率"}},[a._v("#")]),a._v(" 表空间空闲率")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330210231473.png",alt:"/image//image-20220330210231473"}})]),a._v(" "),t("p",[a._v('SELECT count(*) as "number of pages",pg_size_pretty(cast(avg(avail) as bigint)) as "Av. freespace size",round(100 * avg(avail)/8192 ,2) as "Av. freespace ratio" FROM pg_freespace(\'test\');')]),a._v(" "),t("p",[a._v("SELECT *, round(100 * avail/8192 ,2) as \"freespace ratio\" FROM pg_freespace('test');")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330210240765.png",alt:"/image//image-20220330210240765"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330224151535.png",alt:"/image//image-20220330224151535"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330224308898.png",alt:"/image//image-20220330224308898"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330210319228.png",alt:"/image//image-20220330210319228"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330224404182.png",alt:"/image//image-20220330224404182"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330224435288.png",alt:"/image//image-20220330224435288"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330224509431.png",alt:"/image//image-20220330224509431"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330210330360.png",alt:"/image//image-20220330210330360"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220330224611291.png",alt:"/image//image-20220330224611291"}})]),a._v(" "),t("h1",{attrs:{id:"foreign-data-wrappers-外部数据包装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#foreign-data-wrappers-外部数据包装"}},[a._v("#")]),a._v(" Foreign Data Wrappers（外部数据包装）")]),a._v(" "),t("h2",{attrs:{id:"fdw原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fdw原理"}},[a._v("#")]),a._v(" FDW原理")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220331224905393.png",alt:"/image//image-20220331224905393"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220331225229197.png",alt:"/image//image-20220331225229197"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220331225245174.png",alt:"/image//image-20220331225245174"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220331225304947.png",alt:"/image//image-20220331225304947"}})]),a._v(" "),t("h1",{attrs:{id:"explan查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#explan查看"}},[a._v("#")]),a._v(" EXPLAN查看")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220401144530554.png",alt:"/image//image-20220401144530554"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220401144605868.png",alt:"/image//image-20220401144605868"}})]),a._v(" "),t("h2",{attrs:{id:"解决索引失效的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决索引失效的问题"}},[a._v("#")]),a._v(" 解决索引失效的问题")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220401144658541.png",alt:"/image//image-20220401144658541"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220401144712464.png",alt:"/image//image-20220401144712464"}})]),a._v(" "),t("h2",{attrs:{id:"索引知识"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引知识"}},[a._v("#")]),a._v(" 索引知识")]),a._v(" "),t("h3",{attrs:{id:"btree"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btree"}},[a._v("#")]),a._v(" btree")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220401152126652.png",alt:"/image//image-20220401152126652"}})]),a._v(" "),t("h3",{attrs:{id:"hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hash"}},[a._v("#")]),a._v(" hash")]),a._v(" "),t("h3",{attrs:{id:"gin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gin"}},[a._v("#")]),a._v(" "),t("img",{attrs:{src:"/image//image-20220401152252758.png",alt:"/image//image-20220401152252758"}}),a._v("\tgin"),t("img",{attrs:{src:"/image//image-20220401152457032.png",alt:"/image//image-20220401152457032"}})]),a._v(" "),t("h3",{attrs:{id:"gist"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gist"}},[a._v("#")]),a._v(" gist")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220401152627287.png",alt:"/image//image-20220401152627287"}})]),a._v(" "),t("h3",{attrs:{id:"sp-gist"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sp-gist"}},[a._v("#")]),a._v(" sp-gist")]),a._v(" "),t("p",[t("img",{attrs:{src:"/image//image-20220401152644285.png",alt:"/image//image-20220401152644285"}})])])}),[],!1,null,null,null);t.default=g.exports}}]);